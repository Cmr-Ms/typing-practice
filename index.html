<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>実用入力練習</title>
  <meta name="description" content="変換ありのタイピング練習ができます。">
  <meta name="keywords" content="タイピング, 実用入力, 変換, タイピング練習">
  <style>
    body{
      color: rgb(0, 255, 0);
      background: black;
    }
    #mainframe{
      text-align: center;
      width: 100%;
      height: 70%;
      
    }
    #sentencearea{
      font-size: 32px;
    }
    #nextsentence{
      font-size: 24px;
    }
    #typearea{
      font-size: 22px;
      width: 800px;
      height: 100px;
    }
    #wordsarea{
      font-size: 20px;
      width: 600px;
      height: 100px;
    }
    select{
      font-size: 20px;
    }
    textarea{
      background: black;
      color: rgb(0, 255, 0);
      font-size: 32px;
    }
    button{
      font-size: 30px;
    }
    input[type="number"]{
      font-size: 30px;
    }
  </style>
</head>
<body>
<div id="mainframe">
  <a id="sentencearea"></a><br>
  <a id="nextsentence"></a><br>
  <textarea id="typearea" autofocus placeholder="一番上の文を入力するとカウントダウンが始まります。改行した時点で1文字以上正解の文字があると次のワードに切り替わります(完全に正解の場合は改行も文字数にカウントされます)"></textarea><br>
  <a id="progress"></a><br>
  <a id="countdown"></a><br>
  <textarea id="wordsarea" placeholder="改行区切りでワードを入力  長文モードを使う場合はワードの分け目に改行を2つ入れてください">今年の新入社員です
あたたかいそよ風
一年生になったら
春なのにお別れですか
花見へ行こう
花見だんご
ドキドキ一年生
うららかな春
温かい春の風
日差しの中を歩くんだ
春が好き
キーボードの横にティッシュ
風が春の訪れを感じさせる
吹く風も優しいよ
公園のベンチでひとねむり
入学おめでとう
春はうきうき
春だもの
なんて美味しいつぶつぶイチゴ
大きなランドセル
花見なのか宴会なのか
また春にあいましょう
春はうたた寝
タンポポの綿毛を風に乗せ
涙と笑いのクラス替え
ぽかぽかうれしいもう春だ
あたたかい風が吹きぬける
学校楽しいね
つくし探しに土手まで行こう
別れもあるけど春が好き
新しい教科書だ
新品の生徒手帳はあけにくい
恋の季節到来
新しい自分を始めよう
ともだち１００人できるかな
春一番
上を向いたらピンクの桜
やはり私は花より団子
満開の桜
あの日の桜を忘れないで
あっ、桜が咲いてるよ
新しい友達ができた
小鳥もさえずってるな
だんご三兄弟を思い出す
友だちできるかな
さわやかな空
春が来て君はきれいになった
春が来た、春が来た、どこに来た
新しく出会う人生の仲間達
春の匂いは花の香り
うららうらら春うらら
たんぽぽが食べられるなんて
今日から新学期
学習机が届いたよ
春の小川でめだかと遊ぶ
きっと君にも春が来る
心もふくらむ季節ですね
桜咲いたら一年生
ポカポカ陽気で気持ちいい
ポカポカ陽気
春の花はいい香り
春から社会人
桜きれいだね
春一番の風のいたずら
草餅も好きだけど、桜餅も好き
気づいたらもう受験生だよ
はなやかな春が訪れたよ
くしゃみが止まらない
ピカピカの机とランドセル
ぽかぽか日和
やさしい春の日差し
さわやかな風
新しい１年の始まり
きあいも新たに新年度
暖かい春を感じる
教室間違えちゃった
鼻がむずむず花粉症
モンシロチョウが飛んでいた
桜は咲かせるためにある
入学式とランドセル
自分の名刺が照れくさい
ドキドキの入社式
桜もちの葉の香り
入園入学おめでとう
新品の上履き
今日もまた遅刻
ホーホケキョ
学校は友達を作るところ
ウグイスの声が聞こえた
ついに自分も先輩に
ポカポカ陽気にさそわれて
そよ風がほほをなでる
ドキドキする入学式
桜咲く丘で桜餅を食べよう
きっとあしたは桜さく
公園で昼寝
春は希望のとき
花見の後は、二日酔い
春はあけぼの
お花見にいこう
春になったら迎えにいく
夢ふくらむこの季節
水仙のいい香り
春の小川はさらさらいくよ
外はぽかぽか気持ちいい
風が運ぶ花の匂い
新学期だよ
菜の花の黄色いじゅうたん
気持ちも切り替えて
後輩が入社しました
別れの季節、出会いの季節
あ、たんぽぽ見つけた
昼寝したい
新しい制服です
やっぱり桜は媚薬かも
春の七草全部いえるかな
隣の梅にうぐいす二羽きた
友達いっぱいできるかな
お花見しませんか
春の海ひねもすのたりのたりかな
出会いと別れの季節かな
新入学の春がきた
春は出会いの季節だね
ピカピカのうわぐつ
気づけば今年も受験生
くしゃみ、鼻水、目のかゆみ
春は花が一番きれいな季節
ピクニックに行こう
目がかゆい
五限目の授業はねむたい
眠くなったらタイピング
春だからタイピング
新人は花見で場所とり
新しいスタート
春風そよそよ
桃、梅、桜の区別がつかない
庭の桜が満開だ
いつ覚めるのか春の夢
睡魔と戦う春の授業
あたりを見たら桜満開
お花見に行きました
さわやかな風がすがすがしい
道ばたに咲くタンポポ
春の陽気と恋心
ぼくの心にも春が来るかな
一番大好きな季節
うららかな春の陽気
日なたぼっこしようよ
桜、梅、うぐいす、たんぽぽ
春風はいつもあなたにふいている
スーツがまだ似合わない
スギの次はヒノキ
</textarea><br>
  <input id="seconds" type="number" value="60" onchange="seconds=Number(this.value);reset()">
  <label>秒</label>
  <input id="longwordmode" type="checkbox" onclick="allwords=wordsarea.value.split('\n\n').filter(e=>Boolean(e))"><label>長文モード</label><br>
  <button onclick="reset()">リセット</button><br>
  <a href="https://github.com/Cmr-Ms/typing-practice/tree/main" target="_blank">追加のワード  はこちらから</a><br>
  <a href="https://forms.gle/5AfvtdjJMF1s87c49" target="_blank">ご意見などはこちらから</a>
</div>

  <script>
    const sentencearea = document.querySelector("#sentencearea");
    const nextsentence = document.querySelector("#nextsentence")
    const typearea = document.querySelector("#typearea");
    const progress = document.querySelector("#progress");
    const wordsarea = document.querySelector("#wordsarea");
    const longwordmode = document.querySelector("#longwordmode")
    const countdown = document.querySelector("#countdown")
    const timerseconds = document.querySelector("#seconds")
    escapecount = 0
    typedchars = 0
    typedwords = 0
    backspacecount = 0
    wastingtime = Number(localStorage.getItem("wastingtime") ? localStorage.getItem("wastingtime") : 0)
    function reset(){
      wordtotype = "";
      multilineword = []
      nextword = ""
      typearea.value=""
      started = false
      starttime = 0
      wordstarttime = 0
      wordtypingstarted = false
      endtime = 0
      escapecount = 0
      typedchars = 0
      typedwords = 0
      backspacecount = 0
      seconds = Number(timerseconds.value)
      countdown.innerText = `残り ${seconds} 秒`
      changeprogress()
      changeword()
      clearTimeout(timer)
      clearInterval(countdowntimer)
    }

    function changeprogress(){
      progress.innerText = `${typedchars} 文字, ${typedwords}行, バックスペース ${backspacecount} 回, エスケープ ${escapecount} 回, 浪費した時間 約 ${Math.round(wastingtime)} 秒\n最高スコア ${localStorage.getItem(`highscore${seconds}`) ? localStorage.getItem(`highscore${seconds}`) : 0} 点`
    }
    function changeword(){
      changeprogress()
      wordtypingstarted = false
      wordstarttime = 0
      multilineword.push(...allwords[Math.floor(allwords.length * Math.random())].split("\n"))
      wordtotype = multilineword[0]
      if(!multilineword[1]){
        multilineword.push(...allwords[Math.floor(allwords.length * Math.random())].split("\n"))
      }
      nextword = multilineword[1]
      multilineword = multilineword.slice(1)
      sentencearea.innerText = wordtotype
      nextsentence.innerHTML = "<b>次: </b>"+nextword
      typearea.value = "";
      typearea.style["background-color"] = "rgb(0, 0, 0)"
    }
    function updatestorage(){
      
      localStorage.setItem(`highscore${seconds}`, (Number(localStorage.getItem(`highscore${seconds}`)) <= (typedchars - backspacecount) ? (typedchars - backspacecount) : 0))
      localStorage.setItem("wastingtime", wastingtime)
    }
    window.onload = ()=>{
      allwords=wordsarea.value.split(RegExp(`\\n{${1+longwordmode.checked},}`)).filter(e=>Boolean(e))
      reset()
    }
    wordsarea.addEventListener("input", (e)=>{
      allwords=wordsarea.value.split("\n".repeat(1+longwordmode.checked)).filter(e=>Boolean(e))
      reset();
    })

    typearea.addEventListener("input", (e)=>{
      if(!started && typearea.value){
        started = true
        starttime = Date.now()
        endtime = starttime + 1000*seconds
        timer = setTimeout(
          ()=>{
            if(typearea.value){
              try{
                typedchars += wordtotype.match(new RegExp("(\\"+typearea.value.split("").join(")?(\\")+")?", "g")).join("").length
              }catch{}
            }
            clearInterval(countdowntimer)
            alert(`${typedchars} 文字, ${typedwords} 行, バックスペース ${backspacecount} 回, エスケープ ${escapecount} 回\nスコア: ${typedchars - backspacecount}`);console.log(`${typedchars} 文字, ${typedwords} 行, バックスペース ${backspacecount} 回, エスケープ ${escapecount} 回\nスコア: ${typedchars - backspacecount}`);document.title = `${typedchars - backspacecount} 点 - 実用入力練習`
            updatestorage()
            escapecount = 0
            reset()
          }, endtime - starttime
        )

        countdowntimer = setInterval(
          ()=>{
            countdown.innerText = `残り ${Math.floor((endtime - Date.now()) / 1000)} 秒`
          }, 100
        )

      }
      if((e.inputType === "insertLineBreak" || (e.inputType === "insertText" && (!e.data || e.data ===  "\n")))){
        if(typearea.value.trim() === wordtotype){
          typedchars += typearea.value.length
          typedwords++
        }else{typedchars += typearea.value.match(new RegExp(`(\\${wordtotype.split("").join(")?(\\")})?`, "g")).join("").length}
        changeword()
      }if(wordtotype.startsWith(typearea.value) && typearea.value){
        typearea.style["background-color"] = "rgb(0, 100, 0)"

      }else if(!wordtotype.startsWith(typearea.value) && typearea.value){
        typearea.style["background-color"] = "rgb(100, 0, 0)"

      }else{
        typearea.style["background-color"] = "rgb(0, 0, 0)"
      }if(started && !wordtypingstarted){
        wordtypingstarted = true
        wordstarttime = Date.now()
      }
    })

    typearea.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        escapecount++
        
        wastingtime += endtime ? (seconds - ((endtime - Date.now()) / 1000)) : 0

        reset()
        try{
          clearTimeout(timer)
        }catch(e){}
      }else if (e.code === "Backspace"){
        backspacecount++
        changeprogress()
      }else if(e.code === "Escape"){
        escapecount++
        changeprogress()
      }
    })
  </script>

</body>
</html>
